title: "Preprocess T1-weighted MRI" # Short name for the pipeline referenced in the UI
schema_version: 1.0 # the version of the specification format used for this file
version:
  # Define a version for the pipeline in combination of the underlying package version (e.g. FSL)
  # and the "build" of the pipeline
  package: "1.0"
  build: "1"
base_image:
  # Chose a NeuroDesk FSL container as the base
  name: deepmi/fastsurfer
  package_manager: apt # It is not obvious from the base image what the package manager is
  tag: gpu-v2.2.0
packages:
  # Install dependencies for DICOM->NIfTI conversion
  pip:
    pydra-mrtrix3: 3.0.4a5
    pydra-fsl:
    fileformats:
    pydra-fastsurfer:
    fileformats-medimage-extras:
    fileformats-medimage-mrtrix3: 3.0.4a5
    australianimagingservice:
  neurodocker:
    mrtrix3: 3.0.2
    fsl: 6.0.5.1
authors:
  # Authors of the pipeline. The first email will be considered to be the maintainer of
  # the generated container images
  - name: Arkiev D'Souza
    email: arkiev.dsouza@sydney.edu.au
  - name: Thomas G. Close
    email: thomas.close@sydney.edu.au
licenses:
  freesurfer:
    destination: /opt/freesurfer/license.txt
    info_url: https://surfer.nmr.mgh.harvard.edu/registration.html
    description: >
      FastSurfer, which is used to perform segmentation and surface recon, requires a
      FreeSurfer license to run.
docs:
  info_url: "https://placeholder.org" # Link to external documentation for underlying tool
  description: | # Description of tool for auto-docs
    Generate a 5TT image (HSVS) and parcellation image (Desikan, Destrieux, HCPMMP1,
    Yeo7 and Yeo17) from a single input anatomical image. Input image should satisfy
    the input requirements for FastSurfer
resources:
  neuro-parcellations: /parcellations
commands:
  single_parc:
    task: australianimagingservice.mri.human.neuro.t1w.preprocess:preprocess
    row_frequency: session # the pipeline is desgined to run on imaging "sessions" as opposed to "subjects" or "projects"
    inputs: # List the inputs that are presented to end-user in UI
      t1w:
        datatype: medimage/nifti-gz # MIME-type or "MIME-like" format
        help: "T1-weighted anatomical scan" # description of field presented in U
        column_defaults:
          datatype: medimage/nifti-gz # medimage/dicom-series  # the default
    outputs: # List the outputs generated by the pipeline
      parcellation:
        field: parc_image
        datatype: medimage-mrtrix3/image-format # MIME-type or "MIME-like" format
        help: parcellation image generated # description of field presented in UI
      vis_image_fsl:
        field: vis_image_fsl
        datatype: medimage-mrtrix3/image-format-gz # MIME-type or "MIME-like" format
        help: 5ttvis image FSL # description of field presented in UI
      ftt_image_fsl:
        field: ftt_image_fsl
        datatype: medimage-mrtrix3/image-format-gz # MIME-type or "MIME-like" format
        help: 5tt image FSL # description of field presented in UI
      vis_image_freesurfer:
        field: vis_image_freesurfer
        datatype: medimage-mrtrix3/image-format-gz # MIME-type or "MIME-like" format
        help: 5ttvis image FreeSurfer # description of field presented in UI
      ftt_image_freesurfer:
        field: ftt_image_freesurfer
        datatype: medimage-mrtrix3/image-format-gz # MIME-type or "MIME-like" format
        help: 5tt image FreeSurfer # description of field presented in UI
      vis_image_hsvs:
        field: vis_image_hsvs
        datatype: medimage-mrtrix3/image-format-gz # MIME-type or "MIME-like" format
        help: 5ttvis image HSVS # description of field presented in UI
      ftt_image_hsvs:
        field: ftt_image_hsvs
        datatype: medimage-mrtrix3/image-format-gz # MIME-type or "MIME-like" format
        help: 5tt image HSVS # description of field presented in UI
    parameters:
      parcellation:
        datatype: field/text # Format of the field
        help: parcellation type # description of field presented in UI
        default: desikan # Default value, filled in on the UI
    configuration: # Additional args passed to arcana.common:shell_cmd
      mrtrix_lut_dir: /parcellations # /opt/mrtrix3-3.0.2/share/mrtrix3/labelconvert
      fs_license: /opt/freesurfer/license.txt
      freesurfer_home: /opt/freesurfer
      cache_dir: /work/pydra-cache
      fastsurfer_executable:
        - /fastsurfer/Docker/entrypoint.sh
        - /fastsurfer/run_fastsurfer.sh
        - --allow_root
  all_parcs:
    task: australianimagingservice.mri.human.neuro.t1w.preprocess:preprocess_all_parcs
    row_frequency: session # the pipeline is desgined to run on imaging "sessions" as opposed to "subjects" or "projects"
    inputs: # List the inputs that are presented to end-user in UI
      t1w:
        datatype: medimage/nifti-gz # MIME-type or "MIME-like" format
        help: "T1-weighted anatomical scan" # description of field presented in U
        column_defaults:
          datatype: medimage/nifti-gz # medimage/dicom-series  # the default
    outputs: # List the outputs generated by the pipeline
      parcellations:
        field: parcellations
        datatype: medimage-mrtrix3/image-format+directory-of # MIME-type or "MIME-like" format
        help: generated parcellation images # description of field presented in UI
      vis_image_fsl:
        field: vis_image_fsl
        datatype: medimage-mrtrix3/image-format-gz # MIME-type or "MIME-like" format
        help: 5ttvis image FSL # description of field presented in UI
      ftt_image_fsl:
        field: ftt_image_fsl
        datatype: medimage-mrtrix3/image-format-gz # MIME-type or "MIME-like" format
        help: 5tt image FSL # description of field presented in UI
      vis_image_freesurfer:
        field: vis_image_freesurfer
        datatype: medimage-mrtrix3/image-format-gz # MIME-type or "MIME-like" format
        help: 5ttvis image FreeSurfer # description of field presented in UI
      ftt_image_freesurfer:
        field: ftt_image_freesurfer
        datatype: medimage-mrtrix3/image-format-gz # MIME-type or "MIME-like" format
        help: 5tt image FreeSurfer # description of field presented in UI
      vis_image_hsvs:
        field: vis_image_hsvs
        datatype: medimage-mrtrix3/image-format-gz # MIME-type or "MIME-like" format
        help: 5ttvis image HSVS # description of field presented in UI
      ftt_image_hsvs:
        field: ftt_image_hsvs
        datatype: medimage-mrtrix3/image-format-gz # MIME-type or "MIME-like" format
        help: 5tt image HSVS # description of field presented in UI
    parameters:
      parcellation:
        datatype: field/text # Format of the field
        help: parcellation type # description of field presented in UI
        default: desikan # Default value, filled in on the UI
    configuration: # Additional args passed to arcana.common:shell_cmd
      mrtrix_lut_dir: /parcellations # /opt/mrtrix3-3.0.2/share/mrtrix3/labelconvert
      fs_license: /opt/freesurfer/license.txt
      freesurfer_home: /opt/freesurfer
      cache_dir: /work/pydra-cache
      fastsurfer_executable:
        - /fastsurfer/Docker/entrypoint.sh
        - /fastsurfer/run_fastsurfer.sh
        - --allow_root
